<!DOCTYPE html>
<html lang="es">
<head>
<meta http-equiv="Content-Type" content="text/html; UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<title>gestion</title>
</head>
<body>
	<div class="card z-depth-2">
		<div class="card-header">
			<h2 class="panel-title">
				GESTION BENEFICIARIOS <small>Administre beneficiarios
					registrados en el Sistema</small>
			</h2>
 		</div>
		<div class="panel-body table-responsive" style="margin-top: -30px">
			<div class="">
				
				<div class="col-md-12 navbar-right" style="text-align: right;margin-bottom: 15px">			
					<button id="btn-add" class="btn btn-default waves-effect" disabled="disabled">NUEVO BENEFICIARIO</button>
				</div>
				<div class="col-md-12">
					<div class="row">
						<div class="col-md-3 col-xs-12" style="margin-bottom: 10px;">
							<input type="text" id="filt-ben" name=""
								class="form-control_filtro unput-sm"
								placeholder=" Buscar Apellidos nombres o cedula..">
						</div>
						<div class="col-md-3 col-xs-12"><button id="generarR">GenerarReporte</button></div>
						<div class="col-md-6 col-xs-12 navbar-right" style="text-align: right; margin-top: 10px">
							<label class="radio radio-inline m-r-20"> <input
								type="radio" name="iestado" id="activos" value="1"> <i
								class="input-helper"></i>activos
							</label> <label class="radio radio-inline m-r-20"> <input
								type="radio" name="iestado" id="bajas" value="0"> <i
								class="input-helper"></i>bajas
							</label> <label class="radio radio-inline m-r-20"> <input
								type="radio" name="iestado" id="todos" value="-1"
								checked="checked"> <i class="input-helper"></i>todos
							</label>
						</div>
					</div>
				</div>
				<div class="col-md-12">
					<table id="table-beneficiarios" class="table table-vmiddle"
						width="100%">
						<thead>
							<tr>
								<th class="text-center">#</th>
								<th class="text-center">beneficiario</th>
								<th class="text-center">ci</th>
								<th class="text-center">direccion</th>
								<th class="text-center">Estado</th>
								<th class="text-center">Opciones</th>

							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
	<form id="formulario-add" action="../RestBeneficiarios/adicionar" method="post" 
        data-fv-excluded="disabled">
        <div class="modal fade" id="modal-add" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-hidden="true" style="display: none;padding-left: 0">
           <div class="modal-dialog modal-md" role="document">
             <div class="modal-content">
                <div class="card">
                    <div class="card-header">
                        <button type="button" class="close exit" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h2>Adicionar Beneficiario<small>Complete el formulario por favor</small></h2>
                    </div>
                    <div class="modal-body">                      
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group fg-float">
                                    <div class="fg-line">
                                        <input class="form-control fg-input" maxlength="8" id="cedula" name="ci" type="text"  data-fv-notempty="true" data-fv-message="Requiere Cedula" data-fv-integer="true" data-fv-integer-message="El valor de este campo debe ser numerico y sin espacios en blanco">
                                    </div>
                                    <label class="fg-label">Cedula</label>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <div class="fg-line">
                                        <select data-placeholder="n" name="ciCod" class="form-control" data-fv-notempty='true' data-fv-message="Requiere Ciudadania" id="ciCod">
                                            <option value="TJ">TJ</option>
                                            <option value="PT">PT</option>
                                            <option value="PA">PA</option>
                                            <option value="LP">LP</option>
                                            <option value="OR">OR</option>
                                            <option value="CB">CB</option>
                                            <option value="BN">BN</option>
                                            <option value="CH">CH</option>
                                            <option value="SC">SC</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group fg-float">
                                    <div class="fg-line">
                                        <input class="form-control fg-input"  name="nombres" type="text" data-fv-notempty="true" data-fv-message="Requiere Nombres">
                                    </div>
                                    <label class="fg-label">Nombres</label>
                                </div>
                            </div>
                         </div>
                         <div class="row">
                            <div class="col-md-6">
                                <div class="form-group fg-float">
                                    <div class="fg-line">
                                        <input class="form-control fg-input"  name="ap" type="text" data-fv-notempty="true" data-fv-message="Requiere Apellido Paterno">
                                    </div>
                                    <label class="fg-label">Apellido Paterno</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group fg-float">
                                    <div class="fg-line">
                                        <input class="form-control fg-input"  name="am" type="text" maxlength='10', data-fv-stringlength-message='Ingrese apellido materno'>
                                    </div>
                                    <label class="fg-label">Apellido Materno</label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <div class="fg-line">
                                        <select data-placeholder="n" name="genero" class="form-control" data-fv-notempty='true' data-fv-message="Requiere Género" id="select-genero">
                                            <option value="">Seleccione Género</option>
                                            <option value="m">Masculino</option>
                                            <option value="f">Femenino</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group fg-float">
                                    <div class="fg-line">
                                        <input class="form-control fg-input"  name="direccion" type="text" data-fv-notempty="true" data-fv-message="Requiere Dirección">
                                    </div>
                                    <label class="fg-label">Dirección</label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                <div class="col-md-6">
                                    <div class="form-group fg-float">
                                        <div class="fg-line">
                                            <input class="form-control fg-input"  name="email" type="email" >
                                        </div>
                                        <label class="fg-label">Correo</label>
                                    </div>    
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group fg-float">
                                        <div class="fg-line">
                                            <input class="form-control fg-input"  name="institucion" type="institucion" data-fv-notempty="true" data-fv-message="Requiere Institucion">
                                        </div>
                                        <label class="fg-label">Institucion</label>
                                    </div>    
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group fg-float">
                                        <div class="fg-line">
                                            <textarea  class="form-control fg-input" id="text-desc" name="descripcion" type="institucion" maxlength="30">                                    
                                            </textarea>
                                        </div>
                                        <label class="fg-label">Descripcion</label>
                                    </div>    
                                </div>
                            </div>
                             <div class="form-group">
                                <label class="col-xs-3 control-label">Telefonos/Celulares</label>
                                <div class="col-xs-5">
                                    <input type="text" class="form-control" name="telefono[]" placeholder="Ingrese número" maxlength="10"/>
                                </div>
                                <div class="col-xs-4">
                                    <button type="button" class="btn btn-default addButton"><i class="fa fa-plus"></i></button>
                                </div>
                            </div>
                            <div class="form-group hide" id="optionTemplate-add" >
                                <div class="col-xs-offset-3 col-xs-5">
                                    <input class="form-control" type="text" name="" placeholder="Ingrese número" maxlength="10"/>
                                </div>
                                <div class="col-xs-4">
                                    <button type="button" class="btn btn-default removeButton"><i class="fa fa-minus"></i></button>
                                </div>
                            </div>
                        </div>
                        <br><br>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-5 control-label">Documentos Presentados</label>
                                    <div class="col-md-7" id="js_doc">
        
                                    </div>  
                                     <input type="hidden" name="" id="m_cont_doc" value="4">                      
                                </div>

                            </div>
                        </div>   
                    </div>
                    <div class="modal-footer">
                        <button type="submit" id="btnAdicionarConfirmacion" class="btn btn-primary waves-effect"> Guardar</button>
                        <button type="button" class="btn btn-danger waves-effect exit" data-dismiss="modal"> Cancelar</button>
                    </div>
                </div>
              </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
    </form>  
    <form id="formulario-mod" action="../RestBeneficiarios/modificar" method="post" 
    data-fv-excluded="disabled">
        <div class="modal fade" id="modal-mod" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-hidden="true" style="display: none;padding-left: 0">
           <div class="modal-dialog modal-md" role="document">
             <div class="modal-content">
                <div class="card">
                    <div class="card-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h2>Modificar Beneficiario2<small>Complete el formulario por favor</small></h2>
                    </div>
                    <div class="modal-body">                      
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group fg-float">
                                    <div class="fg-line">
                                        <input disabled="disabled" class="form-control fg-input" maxlength="8" id="cedula" name="ci" type="text"  data-fv-notempty="true" data-fv-message="Requiere Cedula" data-fv-integer="true" data-fv-integer-message="El valor de este campo debe ser numerico y sin espacios en blanco">
                                    </div>
                                    <label class="fg-label">Cédula</label>
                                </div>
                            </div>
                             <div class="col-md-2">
                                <div class="form-group">
                                    <div class="fg-line">
                                        <select disabled="disabled" data-placeholder="n" name="ciCod" class="form-control" data-fv-notempty='true' data-fv-message="Requiere Ciudadania" id="ciCod">
                                            <option value="TJ">TJ</option>
                                            <option value="PT">PT</option>
                                            <option value="PA">PA</option>
                                            <option value="LP">LP</option>
                                            <option value="OR">OR</option>
                                            <option value="CB">CB</option>
                                            <option value="BN">BN</option>
                                            <option value="CH">CH</option>
                                            <option value="SC">SC</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group fg-float">
                                    <div class="fg-line">
                                        <input class="form-control fg-input"  name="nombres" type="text" data-fv-notempty="true" data-fv-message="Requiere Nombres">
                                    </div>
                                    <label class="fg-label">Nombres</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group fg-float">
                                    <div class="fg-line">
                                        <input class="form-control fg-input"  name="ap" type="text" data-fv-notempty="true" data-fv-message="Requiere Apellido Paterno">
                                    </div>
                                    <label class="fg-label">Apellido Paterno</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group fg-float">
                                    <div class="fg-line">
                                        <input class="form-control fg-input"  name="am" type="text" maxlength='10', data-fv-stringlength-message='Ingrese apellido materno'>
                                    </div>
                                    <label class="fg-label">Apellido Materno</label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <div class="fg-line">
                                        <select data-placeholder="n" name="genero" class="form-control" data-fv-notempty='true' data-fv-message="Requiere Género" id="select-genero">
                                            <option value="">Seleccione Género</option>
                                            <option value="m">Masculino</option>
                                            <option value="f">Femenino</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group fg-float">
                                    <div class="fg-line">
                                        <input class="form-control fg-input"  name="direccion" type="text" data-fv-notempty="true" data-fv-message="Requiere Dirección">
                                    </div>
                                    <label class="fg-label">Dirección</label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                <div class="col-md-6">
                                    <div class="form-group fg-float">
                                        <div class="fg-line">
                                            <input class="form-control fg-input"  name="email" type="email">
                                        </div>
                                        <label class="fg-label">Correo</label>
                                    </div>    
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group fg-float">
                                        <div class="fg-line">
                                            <input class="form-control fg-input"  name="institucion" type="institucion" data-fv-notempty="true" data-fv-message="Requiere Institucion">
                                        </div>
                                        <label class="fg-label">Institucion</label>
                                    </div>    
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group fg-float">
                                        <div class="fg-line">
                                            <textarea  class="form-control fg-input" id="text-desc" name="descripcion" type="institucion" maxlength="30">                                    
                                            </textarea>
                                        </div>
                                        <label class="fg-label">Descripcion</label>
                                    </div>    
                                </div>
                            </div>
                            <div id="contenido-tel">
                            </div>
                            <div class="form-group hide" id="optionTemplate-mod" >
                                <div class="col-xs-offset-3 col-xs-5">
                                    <input class="form-control" type="text" name="" placeholder="Ingrese número" maxlength="10"/>
                                </div>
                                <div class="col-xs-4">
                                    <button type="button" class="btn btn-default removeButton"><i class="fa fa-minus"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-5 control-label">Documentos Presentados</label>
                                    <div class="col-md-7" id="js_docMod">
                                    </div>
                                   
                                    </select>                            
                                </div>

                            </div>
                        </div>   
                    </div>
                    <div class="modal-footer">
                        <button type="submit" id="btnAdicionarConfirmacion" class="btn btn-primary waves-effect"> Guardar</button>
                        <button type="button" class="btn btn-danger waves-effect" data-dismiss="modal" id="btn_cancel"> Cancelar</button>
                    </div>
                </div>
              </div>
            </div>
        </div>
    </form>  
    <script type="" src="../bower_components/jquery.nicescroll/dist/jquery.nicescroll.js"></script>
    <script type="" src="../bower_components/autosize/dist/autosize.js"></script>    
    <script type="" src="../js/tema/js/functions.js"></script>
	<script type="text/javascript">
        var result=Get_Opciones(null);
        // console.log('GESTION_LIST: ',result)
        // console.log('tam: ',result.AccionesUser.length)
        if(ExisteOpcion('adicionar')){
            $('#btn-add').attr({
                onclick:"(Beneficiario.add())",
                // accesskey:""
                })
            $('#btn-add').removeAttr("disabled ").focus().val("Ahora si lo puedes utilizar")
        }

        function ExisteOpcion(opc){
            // alert('entro comparar')
            var resultado=false;
            for (var i = 0; i < result.AccionesUser.length; i++) {
                console.log('for_: ',result.AccionesUser[i]);
                if(result.AccionesUser[i].codigo==opc){
                    resultado=true;         
                }
            }
            // console.log('result_dentro:',resultado)              
            return resultado;
        }
        var filtro=$('#filt-ben').val();
        var estado=$('input[name="iestado"]:checked').val();
        listar();

        $('#filt-ben').on('keyup',function(){
            filtro=$(this).val();
            listar();
        })

        $('input[name="iestado"]').on('change',function(){
            estado=$(this).val();
            listar();
        })
        var DTBeneficiario='';
        function listar(){
            $.ajax({
                url:'../RestBeneficiarios/listar',
                type:'post',
                dataType:'json',
                data:{
                    filtro:filtro,
                    estado:estado,
                },
                success:function(resp){
                    console.log('icont_')
                    if ($.fn.DataTable.isDataTable('#table-beneficiarios')) {
                        DTBeneficiario.destroy();
                        iniciarDatable(resp);       
                    } else {
                        iniciarDatable(resp);
                    }   
                },
                error:function(err){
                    alert('sin respuesta del servidor')
                }
            })
        }
      
        function iniciarDatable(lista){
            console.log('respuestaAjax: ',lista);
            DTBeneficiario=$('#table-beneficiarios').DataTable({
                "oLanguage": {
                    "sUrl": "../js/dataTables/Spanish.lang"
                },
                // responsive:true,
                "dom":'rt<button>ip',
                // "ordering":false,
                "pageLength":5,
                data:lista,
                columns:[
                    {data:'ci'},
                    {data:'ci'},
                    {data:'ci'},
                    {data:'ci'},
                    {data:'estado'},
                    {data:'ci'},
                ]
                ,
                "createdRow":function(row,data,index){
                    $('td',row).eq(0).html(index+1).addClass('text-center');
                    $('td',row).eq(1).html(data.ap+' '+data.am+' '+data.nombres).addClass('text-center')
                    $('td',row).eq(2).html(data.ci).addClass('text-center')
                    $('td',row).eq(3).html(data.direccion).addClass('text-center')
                    if(data.beneficiario.estado==1){
                        $('td',row).eq(4).html('<a type="button" class="" href="#" style="text-align:center"><i class="fa fa-thumbs-o-up"></i></a>').addClass('text-center').addClass('text-center');
                    }else{
                        $('td',row).eq(4).html('<a type="button" class="" href="#" style="text-align:center"><i class="fa fa-thumbs-o-down"></i></a>').addClass('text-center').addClass('text-center');
                    }
                    if(ExisteOpcion('modificar')){
                        $('td',row).eq(5).html('<button id="btn-mod" class="btn btn-info btn-sm waves-effect btn-espacio" accesskey="'+data.beneficiario.idben+'" data-href="'+data.beneficiario.idper+'" onclick="(Beneficiario.mod(this))"><span class="zmdi zmdi-edit"></span> Modificar</button>')
                        // $('td',row).eq(5).append('<button>hola</button>')
                    }else{
                        $('td',row).eq(5).html('<button id="btn-mod" class="btn btn-info btn-sm waves-effect btn-espacio" disabled="disabled"><span class="zmdi zmdi-edit"></span> Modificar</button>') 
                    }
                    if(data.beneficiario.estado==1){
                        if(ExisteOpcion('eliminar')  ){
                            // if()
                            $('td',row).eq(5).append('<button id="btn-elim" class="btn btn-danger btn-sm waves-effect btn-espacio" accesskey="'+data.beneficiario.idben+'" data-href="'+data.beneficiario.idper+'" onclick="(Beneficiario.elim(this))"><span class="zmdi zmdi-delete"></span> Eliminar</button>');
                        }else{
                            $('td',row).eq(5).append('<button id="btn-elim" class="btn btn-danger btn-sm waves-effect btn-espacio" disabled="disabled"><span class="zmdi zmdi-delete"></span> Eliminar</button>');  
                        }
                    }else{
                        if(ExisteOpcion('habilitar')){
                            $('td',row).eq(5).append('<button id="btn-hab" class="btn btn-success btn-sm waves-effect btn-espacio" accesskey="'+data.beneficiario.idben+'" data-href="'+data.beneficiario.idper+'" onclick="(Beneficiario.hab(this))"><span class="zmdi zmdi-time-restore-setting"></span> Habilitar</button>');
                        }else{
                            $('td',row).eq(5).append('<button id="btn-hab" class="btn btn-success btn-sm waves-effect btn-espacio" disabled="disabled"><span class="zmdi zmdi-time-restore-setting"></span> Habilitar</button>');   
                        }                       
                    }

                }
                ,
                "drawCallback":function(settings){
                    // $('#btn-mod').click(function(){
                        // alert('destroy')
                        // $('#formulario-mod').data('formValidation').resetForm(true);
                        // $('#formulario-mod').formValidation('destroy',true)
                    // })
                    destruir(DTBeneficiario);
                }
            });
        }

        function destruir(dt){
            console.log('destroy')
            dt.destroy();
            DTBeneficiario=$('#table-beneficiarios').DataTable({
                "oLanguage": {
                    "sUrl": "../js/dataTables/Spanish.lang"
                },
                "dom":'rt<button>ip',
                "pageLength":5,
                responsive:true
            })
        }
            // $(function () {
      	var MAX_TELEFONOS = 3;
        var m_cont_doc=0;
        var formAdd;
        var formAdd;
        var idben;
        var idper;
        
        $.post('/RestBeneficiarios/documentosBeneficiario',function(respDoc){
            m_cont_doc=respDoc.length
        })

        formAdd=$('#formulario-add').formValidation({
            fields:{
                ci:{
                    validators:{
                        callback:{
                            message:'callback cedula existente',
                            callback:function(value,validator,$field){
                                console.log('valor de cedula: ',value)
                                
                                $.ajax({
                                    url:"../RestBeneficiarios/existeCi",
                                    data:{
                                        ci:value
                                    },
                                    type:"post",
                                    dataType:"json",
                                    async:false,
                                    cache:false,
                                    success:function(resp){
                                        respCi=resp.estado
                                    },  
                                    error:function(err){
                                        alert('sin respuesta del servidor')
                                    }

                                })
                                
                                if(respCi){
                                     return {
                                         valid:false,
                                         message:'esta cedula ya esta registrada'
                                     } 
                                }else{
                                    return true;    
                                }
                                
                            }
                        }
                    }
                },
                'documentos[]': {
                    validators: {
                        notEmpty: {
                            message: 'Seleccione por favor'
                        },
                        choice: {
                            min: $('#formulario-add').find('#m_cont_doc').val(),
                            max: m_cont_doc,
                            message: 'Seleccione todos los documentos '
                        }
                    }
                },
                'telefono[]': {
                    validators: {
                        stringLength: {
                            max: 10,
                            message: 'El tama�o debe ser maximo hasta 10 caracteres'
                        }
                    }
                }
            }
        })
        .on('click', '.addButton', function() {
            var $template = $('#optionTemplate-add');
            var   $clone    = $template
                                .clone()
                                .removeClass('hide')
                                .removeAttr('id')
                                .addClass('telf-add-clon')
                                .insertBefore($template);
            $clone.find('.form-control').attr('name','telefono[]');
            var   $option   = $clone.find('[name="telefono[]"]');
             // $('#formulario-add').data('formValidation').revalidateField($option);  
            $('#formulario-add').formValidation('addField', $option);
        })
        .on('click', '.removeButton', function() {
            var $row    = $(this).parents('.form-group'),
                $option = $row.find('[name="telefono[]"]');
            console.log('padre: ',$row)
            $row.remove();
            $('#formulario-add').formValidation('removeField', $option);
        })
        .on('added.field.fv', function(e, data) {
            if (data.field === 'telefono[]') {
                if ($('#formulario-add').find(':visible[name="telefono[]"]').length >= MAX_TELEFONOS) {
                    $('#formulario-add').find('.addButton').attr('disabled', 'disabled');
                }
            }
        })
        .on('removed.field.fv', function(e, data) {
           if (data.field === 'telefono[]') {
                if ($('#formulario-add').find(':visible[name="telefono[]"]').length < MAX_TELEFONOS) {
                    $('#formulario-add').find('.addButton').removeAttr('disabled');
                }
            }
        })
        .on('success.form.fv', function(e){
           e.preventDefault();
           
           Registrar();
        })

        formMod=$('#formulario-mod').formValidation({  
            fields:{
                'documentos[]': {
                    validators: {
                        choice: {
                            min: m_cont_doc,
                            max: m_cont_doc,
                            message: 'Seleccione todos los documentos '
                        }
                    }
                },
                'telefono[]': {
                    validators: {
                        stringLength: {
                            max: 10,
                            message: 'El tama�o debe ser maximo hasta 10 caracteres'
                        }
                    }
                }
            }                          
        })
        .on('click', '.addButton', function() {
            var $template = $('#optionTemplate-mod');
                var   $clone = $template
                                    .clone()
                                    .removeClass('hide')
                                    .removeAttr('id')
                                    .addClass('telf-clon')
                                    .insertBefore($template);
                $clone.find('.form-control').attr('name','telefono[]');
                var   $option   = $clone.find('[name="telefono[]"]');
                // console.log('opcionnnn: ',$option)
            $('#formulario-mod').formValidation('addField',"telefono[]");
        })
        .on('click', '.removeButton', function() {
            var $row    = $(this).parents('.form-group'),
                $option = $row.find('[name="telefono[]"]');
            console.log('padre: ',$row)
            $row.remove();

            $('#formulario-mod').formValidation('removeField', $option);
        })
        .on('added.field.fv', function(e, data) {
            if (data.field === 'telefono[]') {
                if ($('#formulario-mod').find(':visible[name="telefono[]"]').length >= MAX_TELEFONOS) {
                    $('#formulario-mod').find('.addButton').attr('disabled', 'disabled');
                }
            }
        })
        .on('removed.field.fv', function(e, data) {
           if (data.field === 'telefono[]') {
                if ($('#formulario-mod').find(':visible[name="telefono[]"]').length < MAX_TELEFONOS) {
                    $('#formulario-mod').find('.addButton').removeAttr('disabled');
                }
            }
        })
        .on('success.form.fv', function(e){
           e.preventDefault();
           Modificar();
        })
         // Now Destroy
        //  destroyFormValidation();

        // function destroyFormValidation()
        // {
        //     try
        //     {
        //         $('#formulario-add').data('formValidation').destroy()
        //         $('#formulario-mod').data('formValidation').destroy()
        //     }
        //     catch(e)
        //     {}
        // }

        var Beneficiario={
            add:function(){
                var cont_doc=0;
                // $('.telf-add-clon').remove()
                // $('#formulario-add').data('formValidation').resetForm(true);
                resetearFormulario('#formulario-add')
                // $('#formulario-add')[0].reset();
                // $('#formulario-mod').removeClass('has-error');
                // $('#formulario-mod .help-block').remove();
                $('#text-desc').val('')
                $('#select-genero').chosen()
                $('#ciCod').chosen()

  

                getDataAdd(function(call){
                    if(call){
                        $('#modal-add').modal('show')
                        // formAdd.data('formValidation').resetForm(true);
                    }else{
                        alert('No se comppleto el formulario')
                    }
                })
                // function callbackDoc(callback){
                    // callback(respDoc.length)
                // }     
               
            },
            mod:function(a){
                idben=$(a).attr('accesskey');
                idper=$(a).data('href');
                // var content=1;
                // $('#formulario-mod').data('formValidation').resetForm(true);
                // $('#formulario-mod')[0].reset()
                // $('#formulario-mod').removeClass('has-error');
                // $('#formulario-mod').remove();
                resetearFormulario('#formulario-mod')

                // $('#formulario-mod').formValidation('destroy',true)
                $('.telf-clon').remove()

                // $('#modal-mod').modal('show') 
                var cont=0;
                getDatasMod(idben)
            },
            elim:function(a){
                console.log('eliminar')
                $.post('../RestBeneficiarios/eliminar',function(resp){
                    alert(resp) 
                })
            },
            hab:function(a){
                console.log('habilitar')    
            }
        }
        function getDataAdd(callback){
            $.post('/RestBeneficiarios/documentosBeneficiario',function(respDoc){
                $('#formulario-add').find('#js_doc').html('')
                console.log('listaDoc: ',respDoc)
                $(respDoc).each(function(index,item){
                    console.log('index_ckec:',index)
                    contador_tam=index+1;
                    $('#js_doc').append(
                        `<div class="checkbox m-b-15">
                            <label>
                                <input value="${item.iddocb}" type="checkbox" name="documentos[]" >
                                <i class="input-helper" ></i>${item.nombre}
                            </label>
                        </div>`
                    );
                })
                $('#formulario-add').find('#m_cont_doc').val(respDoc.length);
                m_cont_doc=respDoc.length
                $('#formulario-add').formValidation('addField','documentos[]');
            })
           
            callback(true)
        }
        function getDatasMod(idben){
            $.post('../RestBeneficiarios/datos-mod',{idben:idben},function(resp){
                $('#formulario-mod').find('#contenido-tel').html('');
                $('#formulario-mod').find('#js_docMod').html('')
                
                console.log('respuestaDatosModificarPost: ',resp)
                $('#text-desc').val('')
                $('#formulario-mod').find('.fg-line').addClass('fg-toggled'); 
                $('#formulario-mod').loadJSON(resp[0])
                $('#formulario-mod').find('input[name="institucion"]').val(resp[0].beneficiario.institucion);
                $('#formulario-mod').find('textarea[name="descripcion"]').val(resp[0].beneficiario.descripcion);
                $('#ciCod').chosen()
                $('#select-genero').chosen()
                $('#modal-mod').modal('show')
                var telSC;
                if(resp[1].length!=0){
                   $(resp[1]).each(function(index,item){
                       console.log('index: ',index)
                       if(index==0){//con boton +
                           telSC=`<div class="form-group" id="ExisteTelOr">
                                <label class="col-xs-3 control-label">Telefonos/Celulares</label>
                                <div class="col-xs-5">
                                    <input type="text" class="form-control" name="telefono[]" value="${item.numero}" placeholder="Ingrese n�mero" maxlength="10"/>
                                </div>
                                <div class="col-xs-4">
                                    <button type="button" class="btn btn-default addButton"><i class="fa fa-plus"></i></button>
                                </div>
                           </div>`
                           $('#contenido-tel').append(telSC);
                           var   $option   = $('#ExisteTelOr').find('[name="telefono[]"]');
                           $('#formulario-mod').formValidation('addField', $option);
                       }else{
                            telSC=`<div class="form-group ClassExisteTel">
                                      <div class="col-xs-offset-3 col-xs-5">
                                        <input class="form-control" type="text" name="telefono[]" value="${item.numero}" placeholder="Ingrese n�mero" maxlength="10"/>
                                      </div>
                                      <div class="col-xs-4">
                                        <button type="button" class="btn btn-default removeButton"><i class="fa fa-minus"></i></button>
                                      </div>
                                   </div>`
                             $('#contenido-tel').append(telSC);
                             var   $option   = $('.ClassExisteTel').find('[name="telefono[]"]');
                             $('#formulario-mod').formValidation('addField', $option);      
                       }           
                   })      
                }else{
                       telSC=`<div class="form-group" id="origenT">
                                <label class="col-xs-3 control-label">Telefonos/Celulares</label>
                                <div class="col-xs-5">
                                    <input type="text" class="form-control" name="telefono[]" placeholder="Ingrese n�mero" maxlength="10"/>
                                </div>
                                <div class="col-xs-4">
                                    <button type="button" class="btn btn-default addButton"><i class="fa fa-plus"></i></button>
                                </div>
                           </div>`
                        $('#contenido-tel').html(telSC);
                        var   $option   = $('#origenT').find('[name="telefono[]"]');
                        $('#formulario-mod').formValidation('addField', $option);   
                }
               
                $(resp[2]).each(function(i,d){
                    $('#js_docMod').append(
                    `<div class="checkbox m-b-15">
                        <label>
                            <input value="${d.iddocb}" type="checkbox" name="documentos[]" checked="checked" disabled="disabled" class="doc-mod">
                                <i class="input-helper" ></i>${d.nombre}
                        </label>
                    </div>`    
                    )
                    m_cont_doc=d.length
                })
                $('#formulario-mod').formValidation('addField','documentos[]');   
            },'json')
        } 

        function Registrar(){
            // $('#modal-add').modal('hide')
            swal({   
                title: "Seguro de registrar Beneficiario?",   
                text: "Usted registrara nuevo Beneficiario",   
                type: "warning",   
                showCancelButton: true,   
                confirmButtonColor: "#DD6B55",   
                confirmButtonText: "Si, Continuar!",   
                cancelButtonText: "No, Cancelar!",   
                closeOnConfirm: false,   
                closeOnCancel: false 
            }, function(isConfirm){   
                if (isConfirm) {     
                    $('#formulario-add').ajaxSubmit({
                        success:function(res){
                            console.log('registrado',res)
                            if(res.estado){
                                $.ajax({
                                    url:"../Beneficiarios/Gestion",
                                    success:function(gestion){
                                        $('#contenedor-gestion').html(gestion); 
                                        swal({
                                            title:"Registrado",
                                            text:"Se ha registrado beneficiario exitosamente",
                                            type:"success",
                                            timer: 2000,   
                                            showConfirmButton: false 
                                        });
                                        $('#modal-add').modal('hide')
                                    }
                                })      
                            }
                        }
                    })

                } else {      
                    swal({
                        title:"Cancelado",
                        text:"Se ha cancelado operacion",
                        type:"error",
                        timer:2000,
                        showCancelButton:false,
                        showConfirmButton:false

                    })
                    $('#modal-add').modal('hide')
                } 
            });

        }
        function Modificar(){
            // alert()
            swal({   
                title: "Seguro de modificar Beneficiario?",   
                text: "Usted modificara los datos del Beneficiario",   
                type: "warning",   
                showCancelButton: true,   
                confirmButtonColor: "#DD6B55",   
                confirmButtonText: "Si, Continuar!",   
                cancelButtonText: "No, Cancelar!",   
                closeOnConfirm: false,   
                closeOnCancel: false 
                }, function(isConfirm){   
                    if (isConfirm) {
                        $('.doc-mod').removeAttr('disabled')
                        $('#formulario-mod').find('input[name=ci]').removeAttr("disabled")
                        $('#formulario-mod').find('#ciCod').removeAttr("disabled")
                        $('#formulario-mod').ajaxSubmit({
                            data:{
                                idben:idben,
                                idper:idper
                            },
                            success:function(res){
                                console.log('modificado',res)
                                if(res.estado){
                                    $.ajax({
                                        url:"../Beneficiarios/Gestion",
                                        success:function(gestion){
                                            // $('#contenedor-gestion').html(gestion); 
                                            $('#table-beneficiarios').dataTable().fnDraw('page');
                                            swal({
                                                title:"Modificado",
                                                text:"Se ha modificado beneficiario exitosamente",
                                                type:"success",
                                                timer: 2000,   
                                                showConfirmButton: false 
                                            });
                                            $('#modal-mod').modal('hide')
                                            $('#formulario-mod')[0].reset();
                                            $('#formulario-mod').data('formValidation').resetForm();
                                        }
                                    })      
                                }
                            }
                        })

                    } else {     
                        // swal("Cancelled", "Your imaginary file is safe :)", "error");   
                        swal({
                            title:"Cancelado",
                            text:"Se ha cancelado operacion",
                            type:"error",
                            timer:2000,
                            showCancelButton:false,
                            showConfirmButton:false

                        })
                        $('#modal-mod').modal('hide')
                    } 
            });
        }   



        function resetearFormulario(form){
            // alert('reset destroy')
            $(form).data('formValidation').resetForm(true)
            // var dataForm=$(form).data('formValidation').resetForm(true)
            // if(dataForm){
                // dataForm.destroy()
            // }
            // $(form).data('formValidation').destroy();
        }
        
        $('#generarR').click(function(){ 

  			$("#frameReportes").attr("src",'../Beneficiarios/listaReporte');
  			// location.href='../texto/ver?codt='+$(this).data('id');
  			// location.href='../Beneficiarios/listaReporte';
  			// alert('empezo')
  			// $.ajax({
  			// 	type:"post",
  			// 	url:"../Reportes/reporte",
  			// 	success:function(resp){
  			// 		alert(resp)
  			// 	}
  			// })
			$("#reportes").modal('show');
  		});
        // $('.exit').click(function(){
        //     alert('ok')
        //     $('#formulario-add').data('formValidation').destroy();
        //     $()

        //     $.ajax({
        //         url:"../Beneficiarios/Gestion",
        //         success:function(gestion){
        //             $('#contenedor-gestion').html('');
        //             $('#contenedor-gestion').append(gestion); 
        //         }
        //     })      
        // })
    </script>
</body>
</html>